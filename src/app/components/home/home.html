@if(isShowingDetails()) {
  <app-recipe-details 
  [recipe]="recipeToShowDetails()!"
  (close)="onCloseDetails()"
  >
  </app-recipe-details>
}

@if(isShowingReviews()) {
  <app-recipe-reviews
  (close)="onCloseReviews()"
  (handleReviewChange)="refreshRecipeRating()"
  [reviews]="reviewsToShow()"
  [recipe]="recipeForReviews()"
  >
  </app-recipe-reviews>
}

@if (isAddingRecipe()) {
  <app-add-recipe
  (close)="onCloseAddingRecipe()"
  >
  </app-add-recipe>
}


<!-- home.html -->
<div class="recipes-page">
  <div class="recipes-container">
    
    <div class="recipes-header">
      <div class="left-header">
        @if (accountService.currentUserDto()) {
          <h1 class="recipes-title">Welcome {{accountService.currentUserDto()?.username}}</h1>
        } @else {
          <h1 class="recipes-title">Welcome</h1>
        }
        
        <p class="recipes-subtitle">
        Discover amazing recipes from talented chefs around the world
        </p>
        @if (accountService.currentUserDto()) {
        <button (click)="accountService.logout()" class="logout-btn">
          Logout
        </button>
        } @else {
        <button (click)="this.router.navigateByUrl('/login')" class="login-btn">
          Login
        </button>
        }
      </div>
      <div class="right-header">
        <div class="sort-controls">
      <label class="sort-label">Sort by:</label>
      
      <div class="sort-dropdowns">
        <!-- Sort Field Dropdown -->
        <select class="sort-select" [(ngModel)]="sortBy" (change)="onSortChange()">
          <option value="NAME">Name</option>
          <option value="CALORIES">Calories</option>
          <option value="DIFFICULTY">Difficulty</option>
        </select>
        
        <!-- Sort Direction Dropdown -->
        <select class="sort-select sort-direction" [(ngModel)]="sortDirection" (change)="onSortChange()">
          <option value="ASC">Ascending</option>
          <option value="DESC">Descending</option>
        </select>
      </div>
    </div>
      </div>
      
    </div>
    
    @if (recipeService.pageData()!.content.length > 0) {
      <div class="recipes-grid">
        @for (recipe of recipeService.pageData()!.content; track recipe.id) {
          <app-recipe [recipe]="recipe" (showDetails)="onShowDetails($event)" (showReviews)="onShowReviews($event)"></app-recipe>
        }
      </div>
    }
    
    @if (recipeService.pageData()!.content.length === 0) {
      <div class="no-recipes-container">
        <div class="no-recipes-icon">üçΩÔ∏è</div>
        <h3 class="no-recipes-title">No recipes found</h3>
        <p class="no-recipes-message">
          It looks like there are no recipes available right now. 
          Check back later for delicious new content!
        </p>
      </div>
    }

    <!-- Pagination Controls -->
@if (recipeService.pageData()!.totalPages > 1) {
  <div class="pagination-container">
    
    <!-- Previous Button -->
    <button 
      class="pagination-btn pagination-prev" 
      [disabled]="recipeService.pageData()!.page === 0"
      (click)="onPageChange(recipeService.pageData()!.page - 1)">
      <span class="pagination-icon">‚Äπ</span>
      <span class="pagination-text">Previous</span>
    </button>
    
    <!-- Page Numbers -->
    <div class="pagination-numbers">
      
      <!-- First page -->
      @if (getVisiblePages()[0] > 0) {
        <button 
          class="pagination-number"
          [class.active]="0 === recipeService.pageData()!.page"
          (click)="onPageChange(0)">
          1
        </button>
        
        @if (getVisiblePages()[0] > 1) {
          <span class="pagination-ellipsis">...</span>
        }
      }
      
      <!-- Visible page numbers -->
      @for (page of getVisiblePages(); track page) {
        <button 
          class="pagination-number"
          [class.active]="page === recipeService.pageData()!.page"
          (click)="onPageChange(page)">
          {{ page + 1 }}
        </button>
      }
      
      <!-- Last page -->
      @if (getVisiblePages()[getVisiblePages().length - 1] < recipeService.pageData()!.totalPages - 1) {
        @if (getVisiblePages()[getVisiblePages().length - 1] < recipeService.pageData()!.totalPages - 2) {
          <span class="pagination-ellipsis">...</span>
        }
        
        <button 
          class="pagination-number"
          [class.active]="recipeService.pageData()!.totalPages - 1 === recipeService.pageData()!.page"
          (click)="onPageChange(recipeService.pageData()!.totalPages - 1)">
          {{ recipeService.pageData()!.totalPages }}
        </button>
      }
      
    </div>
    
    <button 
      class="pagination-btn pagination-next" 
      [disabled]="!recipeService.pageData()!.hasNext"
      (click)="onPageChange(recipeService.pageData()!.page + 1)">
      <span class="pagination-text">Next</span>
      <span class="pagination-icon">‚Ä∫</span>
    </button>
    
  </div>
  
  <div class="pagination-info">
    <span class="pagination-stats">
      Page {{ recipeService.pageData()!.page + 1 }} of {{ recipeService.pageData()!.totalPages }}
      ({{ recipeService.pageData()!.totalElements }} total recipes)
    </span>
  </div>
}
    
  </div>

  @if (this.accountService.currentUserDto()) {
  <button class="floating-add-btn" (click)="onAddRecipe()" title="Add new recipe">
    <span class="add-icon">+</span>
  </button>
  }
</div>